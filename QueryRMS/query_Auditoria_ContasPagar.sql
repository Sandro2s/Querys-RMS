-- Empresa : Supermercado São Roque Ltda.
-- Data :26/12/2016 
-- Atualizado em : 26/12/2016
-- Desenvolvedor : Sandro Soares.
-- Solicitante : Solange
-- Descrição : Retorna os titulos pagos do Contas a Pagar para fazer auditória contábil.
----------------------------------------------------------------------------------------------------------------------------
select cpd_empresa as Empresa,
         cpd_loja||cpd_digito as Loja,
         cpd_agenda as agenda,
         to_date(cpd_dt_inclusao,'yy/mm/dd')as Dt_Inclusao,
         cpd_forne||dac(cpd_forne) as Cod_Forn,
         tip_razao_social as Razao_Social,
         rms7to_date(cpm_venc) as Dt_Venc,
         cpd_ntfis as NF ,
         cpd_serie as Serie,
         cpd_vrnota as Vl_Nota,
       decode(cpm_dtpg,0,'0',(Substr((cpm_dtpg),5,6)||'/'||Substr((cpm_dtpg),3,2)||'/'||Substr((cpm_dtpg),1,2))) as Dt_Pag
   from AG1PAGCP,AA2CTIPO
  where cpd_serie           <> 'DUP'
    and cpd_loja            in (120,100,32,30,29,26,25,22,21,20,19,18,15,12,11,9,8,7,5,4,3,2,1)
    and cpd_agenda          in (2,3,4,5,6,7,19,28,30,31,33,38,39,79,202,203,204,205,206,207,208,209,
                                210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,226,227,
                                228,229,232,233,234,235,236,237,238,242,243,244,245,250,252,253,254,
                                255,256,257,258,262,263,264,265,266,267,268,269,270,271,278,279,282,
                                283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,
                                300,302,303,304,305,306,307,308,312,313,314,315,316,317,320,322,323,
                                324,325,326,327,328,329,330,332,333,334,335,336,337,338,339,340,341,
                                352,353,354,356,357,358,359,360,362,363,364,365,366,367,368,369,370,
                                371,372,373,374,375,382,383,385,386,387,388,389,390,392,393,394,396,
                                395,397,398,450,456,462,484,501,502,504,506,509,522,523,524,525,526,
                                527,528,529,530,531,532,533,534,540,551,602,631,635,651,652,653,654,
                                674,682,698,702,703,704,705,706,707,719,723,724,725,743,745,746,747,
                                748,749,750,751,752,753,754,755,756,757,758,759,760,761,763,764,765,
                                766,767,769,770,771,772,774,775,776,777,778,779,780,782,783,784,785,
                                786,787,788,789,790,792,793,794,796,797,798,799,801,802,803,804,806,
                                807,808,809,810,811,812,814,815,816,817,818,819,820,821,822,824,825,
                                826,827,828,829,831,832,833,834,835,836,837,838,839,843,845,846,847,
                                848,849,850,851,871,872,873,874,876,879,881,882,883,884,885,886,887,
                                888,889,890)
    and cpd_recep            <=  to_number(to_char(to_date('&Ult_dia_Mes','dd/mm/yy'),'yymmdd'))--to_number('170531') --160131
    and ( cpm_dtpg           >=  to_number(to_char(to_date('&Ult_dia_Mes','dd/mm/yy'),'yymmdd'))--to_number('170531')--160131
     or   cpm_dtpg           = 0 )
    and cpd_forne = tip_codigo

 union  all

 select cpd_empresa as Empresa,
        cpd_loja||cpd_digito as Loja,
        bagp_agenda as agenda,
        to_date(bagp_dta_agenda,'yy/mm/dd')as Dt_Inclusao,
        to_char( bagp_fornec) as Cod_Forn,
        tip_razao_social as Razao_Social,
        rmsto_date(bagp_vencto)as Dt_Venc,
        bagp_nota as NF,
        bagp_serie as Serie,
        bagp_vlr_nota as Vl_Nota,
        decode(cpm_dtpg,0,'0',(Substr((cpm_dtpg),5,6)||'/'||Substr((cpm_dtpg),3,2)||'/'||Substr((cpm_dtpg),1,2))) as Dt_Pag

   from AG1PAGCP, AA1PADUP,AA2CTIPO
  where cpd_serie            = 'DUP'
    and trunc(bagp_loja/10) in (120,100,32,30,29,26,25,22,21,20,19,18,15,12,11,9,8,7,5,4,3,2,1)
    and bagp_agenda         in (2,3,4,5,6,7,19,28,30,31,33,38,39,79,202,203,204,205,206,207,208,209,
                                210,211,212,213,214,215,216,217,218,219,220,221,222,223,224,226,227,
                                228,229,232,233,234,235,236,237,238,242,243,244,245,250,252,253,254,
                                255,256,257,258,262,263,264,265,266,267,268,269,270,271,278,279,282,
                                283,284,285,286,287,288,289,290,291,292,293,294,295,296,297,298,299,
                                300,302,303,304,305,306,307,308,312,313,314,315,316,317,320,322,323,
                                324,325,326,327,328,329,330,332,333,334,335,336,337,338,339,340,341,
                                352,353,354,356,357,358,359,360,362,363,364,365,366,367,368,369,370,
                                371,372,373,374,375,382,383,385,386,387,388,389,390,392,393,394,396,
                                395,397,398,450,456,462,484,501,502,504,506,509,522,523,524,525,526,
                                527,528,529,530,531,532,533,534,540,551,602,631,635,651,652,653,654,
                                674,682,698,702,703,704,705,706,707,719,723,724,725,743,745,746,747,
                                748,749,750,751,752,753,754,755,756,757,758,759,760,761,763,764,765,
                                766,767,769,770,771,772,774,775,776,777,778,779,780,782,783,784,785,
                                786,787,788,789,790,792,793,794,796,797,798,799,801,802,803,804,806,
                                807,808,809,810,811,812,814,815,816,817,818,819,820,821,822,824,825,
                                826,827,828,829,831,832,833,834,835,836,837,838,839,843,845,846,847,
                                848,849,850,851,871,872,873,874,876,879,881,882,883,884,885,886,887,
                                888,889,890)
    and bagp_duplic          = cpd_ntfis
    and bagp_fornec          = cpd_forne || dac(cpd_forne)
    and bagp_dta_agenda     <=  to_number(to_char(to_date('&Ult_dia_Mes','dd/mm/yy'),'yymmdd'))--to_number('170531')--160131
    and ( cpm_dtpg          >=  to_number(to_char(to_date('&Ult_dia_Mes','dd/mm/yy'),'yymmdd'))--to_number('170531')--160131
     or   cpm_dtpg           = 0 )
    and  cpd_forne = tip_codigo

